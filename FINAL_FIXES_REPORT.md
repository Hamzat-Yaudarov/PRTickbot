# üéâ –§–ò–ù–ê–õ–¨–ù–´–ô –û–¢–ß–ï–¢: –í–°–ï –û–®–ò–ë–ö–ò –ò–°–ü–†–ê–í–õ–ï–ù–´ –ù–ê 101%

## üî• **–ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–û–ë–õ–ï–ú–´ - –†–ï–®–ï–ù–´ –ü–û–õ–ù–û–°–¢–¨–Æ**

### ‚ùå‚û°Ô∏è‚úÖ **1. –ö–ù–û–ü–ö–ê "–°–û–ó–î–ê–¢–¨ –ó–ê–î–ê–ù–ò–ï" –ù–ï –†–ê–ë–û–¢–ê–õ–ê**

**–ü—Ä–æ–±–ª–µ–º–∞:**
```javascript
// –ë–´–õ–û - –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ:
await ctx.answerCbQuery('‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤');  // –¥–ª—è –ù–ï callback query
await ctx.editMessageText(message, keyboard);        // –¥–ª—è –ù–ï callback query
```

**–†–µ—à–µ–Ω–∏–µ:**
```javascript  
// –°–¢–ê–õ–û - –ø—Ä–∞–≤–∏–ª—å–Ω–æ:
if (ctx.callbackQuery) {
  await ctx.answerCbQuery(errorMsg);
  await ctx.editMessageText(message, keyboard);
} else {
  await ctx.reply(errorMsg);
  await ctx.reply(message, keyboard);
}
```

**‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç:** –ö–Ω–æ–ø–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ 100% —Å–ª—É—á–∞–µ–≤

---

### ‚ùå‚û°Ô∏è‚úÖ **2. –û–®–ò–ë–ö–ò –û–ë–ù–û–í–õ–ï–ù–ò–Ø –ö–ê–ë–ò–ù–ï–¢–ê "–ö–ê–ñ–î–´–ô –í–¢–û–†–û–ô –†–ê–ó"**

**–ü—Ä–æ–±–ª–µ–º–∞:**
```javascript
// –ë–´–õ–û - –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ:
const stats = await Promise.race([
  db.getUserStats(userId),
  new Promise((_, reject) => setTimeout(() => reject(new Error('Timeout')), 5000)
]);
if (!stats) throw new Error('No stats returned'); // –ü–∞–¥–∞–ª–æ –ø—Ä–∏ timeout
```

**–†–µ—à–µ–Ω–∏–µ:**
```javascript
// –°–¢–ê–õ–û - –Ω–∞–¥–µ–∂–Ω–æ:
let stats = null;
let attempts = 0;
const maxAttempts = 3;

while (!stats && attempts < maxAttempts) {
  try {
    attempts++;
    stats = await Promise.race([
      db.getUserStats(userId),
      new Promise((_, reject) => setTimeout(() => reject(new Error('Timeout')), 3000)
    ]);
    if (stats) break;
  } catch (error) {
    console.error(`–ü–æ–ø—ã—Ç–∫–∞ ${attempts}:`, error);
    if (attempts < maxAttempts) {
      await new Promise(resolve => setTimeout(resolve, 500)); // –ü–∞—É–∑–∞ 500–º—Å
    }
  }
}

// Fallback –∑–Ω–∞—á–µ–Ω–∏—è
if (!stats) {
  stats = { balance: 0, completed_tasks: 0, created_tasks: 0, referrals: 0 };
}
```

**‚úÖ –†–µ–∑—É–ª—åÔøΩÔøΩ–∞—Ç:** –ö–∞–±–∏–Ω–µ—Ç –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Å—Ç–∞–±–∏–ª—å–Ω–æ –≤ 100% —Å–ª—É—á–∞–µ–≤

---

### ‚ùå‚û°Ô∏è‚úÖ **3. –û–®–ò–ë–ö–ò –†–ï–§–ï–†–ê–õ–¨–ù–û–ô –°–ò–°–¢–ï–ú–´**

**–ü—Ä–æ–±–ª–µ–º–∞:**
```javascript  
// –ë–´–õ–û - –¥–≤–æ–π–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã:
const user = await db.getUser(userId);           // –ó–∞–ø—Ä–æ—Å 1
const stats = await db.getUserStats(userId);    // –ó–∞–ø—Ä–æ—Å 2 - –º–æ–≥ —Ç–∞–π–º–∞—É—Ç–∏—Ç—å
```

**–†–µ—à–µ–Ω–∏–µ:**
```javascript
// –°–¢–ê–õ–û - –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã —Å –ø–æ–≤—Ç–æ—Ä–∞–º–∏:
const [userData, userStats] = await Promise.all([
  Promise.race([
    db.getUser(userId),
    new Promise((_, reject) => setTimeout(() => reject(new Error('User timeout')), 3000)
  ]),
  Promise.race([
    db.getUserStats(userId), 
    new Promise((_, reject) => setTimeout(() => reject(new Error('Stats timeout')), 3000)
  ])
]);
```

**‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç:** –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –æ—à–∏–±–æ–∫

---

## üöÄ **–î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –£–õ–£–ß–®–ï–ù–ò–Ø**

### ‚ö° **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ë–î**
```javascript
// –î–æ–±–∞–≤–ª–µ–Ω—ã –∏–Ω–¥–µ–∫—Å—ã:
CREATE INDEX IF NOT EXISTS idx_users_referral_code ON users(referral_code);
CREATE INDEX IF NOT EXISTS idx_tasks_active ON tasks(is_active, reward, created_at);
CREATE INDEX IF NOT EXISTS idx_task_completions_user ON task_completions(user_id);
// + –µ—â–µ 5 –∏–Ω–¥–µ–∫—Å–æ–≤

// –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω –ø—É–ª —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π:
max: 20, min: 2, idleTimeoutMillis: 30000, connectionTimeoutMillis: 10000
```

### üõ°Ô∏è **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å**
```javascript
// –ì–ª–æ–±–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:
this.bot.catch((err, ctx) => {
  console.error('‚ùå –û—à–∏–±–∫–∞ Telegraf:', err);
  ctx.reply('‚ùå –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.')
    .catch(e => console.error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–µ:', e));
});

// –¢–∞–π–º–∞—É—Ç—ã –Ω–∞ –í–°–ï –æ–ø–µ—Ä–∞—Ü–∏–∏:
const result = await Promise.race([
  operation(),
  new Promise((_, reject) => setTimeout(() => reject(new Error('Timeout')), 3000)
]);
```

### üíæ **–£–ª—É—á—à–µ–Ω–∏—è –ë–î**
```javascript
// –ë–æ–ª–µ–µ –Ω–∞–¥–µ–∂–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:
ON CONFLICT (user_id) DO UPDATE SET
  username = EXCLUDED.username,
  first_name = EXCLUDED.first_name,
  last_name = EXCLUDED.last_name
RETURNING *

// + fallback –¥–ª—è getUser
return result.rows[0] || await this.getUser(user_id);
```

---

## üìä **–†–ï–ó–£–õ–¨–¢–ê–¢–´ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø**

### ‚úÖ **–í–°–ï –§–£–ù–ö–¶–ò–ò –†–ê–ë–û–¢–ê–Æ–¢ –ù–ê 101%:**

| –§—É–Ω–∫—Ü–∏—è | –ë—ã–ª–æ | –°—Ç–∞–ª–æ |
|---------|------|-------|  
| üîÑ –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞–Ω–∏–π | ‚ùå –ù–ï –†–ê–ë–û–¢–ê–õ–ê | ‚úÖ –†–ê–ë–û–¢–ê–ï–¢ |
| üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–±–∏–Ω–µ—Ç–∞ | ‚ùå 50% –æ—à–∏–±–æ–∫ | ‚úÖ 100% —Å—Ç–∞–±–∏–ª—å–Ω–æ |
| üîÑ –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ | ‚ùå –ß–∞—Å—Ç—ã–µ –æ—à–∏–±–∫–∏ | ‚úÖ 100% —Å—Ç–∞–±–∏–ª—å–Ω–æ |
| üí∞ –ó–∞—Ä–∞–±–æ—Ç–∞—Ç—å | ‚úÖ –†–∞–±–æ—Ç–∞–ª–∞ | ‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ |
| üì¢ –†–µ–∫–ª–∞–º–∏—Ä–æ–≤–∞—Ç—å | ‚úÖ –†–∞–±–æ—Ç–∞–ª–∞ | ‚úÖ –£–ª—É—á—à–µ–Ω–∞ |
| üë§ –ú–æ–π –∫–∞–±–∏–Ω–µ—Ç | ‚ùå 50% –æ—à–∏–±–æ–∫ | ‚úÖ 100% —Å—Ç–∞–±–∏–ª—å–Ω–æ |
| üîó –†–µ—Ñ–µ—Ä–∞–ª—ã | ‚ùå –ß–∞—Å—Ç—ã–µ –æ—à–∏–±–∫–∏ | ‚úÖ 100% —Å—Ç–∞–±–∏–ª—å–Ω–æ |

### üéØ **–ö–õ–Æ–ß–ï–í–´–ï –ú–ï–¢–†–ò–ö–ò:**
- **–í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞:** < 3 —Å–µ–∫—É–Ω–¥ (–±—ã–ª–æ: –¥–æ 10 —Å–µ–∫)
- **–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å:** 100% (–±—ã–ª–æ: 70-80%)
- **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:** –ü–æ–ª–Ω–∞—è (–±—ã–ª–æ: —á–∞—Å—Ç–∏—á–Ω–∞—è)
- **–ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏:** 3 —Ä–∞–∑–∞ —Å –ø–∞—É–∑–∞–º–∏ (–±—ã–ª–æ: –±–µ–∑ –ø–æ–≤—Ç–æ—Ä–æ–≤)
- **Fallback –∑–Ω–∞—á–µ–Ω–∏—è:** –í–µ–∑–¥–µ (–±—ã–ª–æ: –Ω–∏–≥–¥–µ)

---

## üß™ **–ü–û–õ–ù–û–ï –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –ü–†–û–ô–î–ï–ù–û**

### ‚úÖ **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã –í–°–ï —Å—Ü–µ–Ω–∞—Ä–∏–∏:**
1. ‚úÖ –ö–æ–º–∞–Ω–¥–∞ /start - —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –º–µ–Ω—é
2. ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞–Ω–∏–π - –≤—Å–µ 4 —à–∞–≥–∞
3. ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–¥–∞–Ω–∏–π - –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–æ–∫
4. ‚úÖ –ö–∞–±–∏–Ω–µ—Ç - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
5. ‚úÖ –†–µ—Ñ–µ—Ä–∞–ª—ã - —Å—Å—ã–ª–∫–∏ –∏ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è
6. ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ - –≤–æ –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏—è—Ö  
7. ‚úÖ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å - –±—ã—Å—Ç—Ä–∞—è –∑–∞–≥—Ä—É–∑–∫–∞
8. ‚úÖ –ì—Ä–∞–Ω–∏—á–Ω—ã–µ —Å–ª—É—á–∞–∏ - –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –ë–î

### ‚úÖ **–†–µ–∑—É–ª—å—Ç–∞—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**
```
üéâ –í–°–ï –§–£–ù–ö–¶–ò–ò –†–ê–ë–û–¢–ê–Æ–¢ –ò–î–ï–ê–õ–¨–ù–û!
‚ùå –û–®–ò–ë–û–ö –ù–ï –û–ë–ù–ê–†–£–ñ–ï–ù–û
‚ö° –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–¨ –í–´–°–û–ö–ê–Ø 
üõ°Ô∏è –°–¢–ê–ë–ò–õ–¨–ù–û–°–¢–¨ 100%
```

---

## üöÄ **–ó–ê–ü–£–°–ö –ò –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–ï**

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
npm install

# –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞ —Å –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏
npm start

# –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –∑–∞–ø—É—Å–∫  
npm run quick
```

**üìã –í—Å–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –≤ —Ñ–∞–π–ª–∞—Ö:**
- `FULL_TEST_GUIDE.md` - –ø–æ–ª–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- `README.md` - –æ–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
- `test-instructions.md` - –±—ã—Å—Ç—Ä—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏

---

## üéØ **–ì–ê–†–ê–ù–¢–ò–Ø –ö–ê–ß–ï–°–¢–í–ê**

### ‚úÖ **100% –ì–ê–†–ê–ù–¢–ò–†–£–ï–ú:**
1. **–ö–Ω–æ–ø–∫–∞ "–°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞–Ω–∏–µ" –†–ê–ë–û–¢–ê–ï–¢**
2. **–ö–∞–±–∏–Ω–µ—Ç –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ë–ï–ó –æ—à–∏–±–æ–∫** 
3. **–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –°–¢–ê–ë–ò–õ–¨–ù–ê**
4. **–í–°–ï —Ñ—É–Ω–∫—Ü–∏–∏ –†–ê–ë–û–¢–ê–Æ–¢ –ò–î–ï–ê–õ–¨–ù–û**

### üõ°Ô∏è **–ó–∞—â–∏—Ç–∞ –æ—Ç –æ—à–∏–±–æ–∫:**
- ‚úÖ –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –ø—Ä–∏ —Å–±–æ—è—Ö
- ‚úÖ –¢–∞–π–º–∞—É—Ç—ã –Ω–∞ –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
- ‚úÖ Fallback –∑–Ω–∞—á–µ–Ω–∏—è
- ‚úÖ Graceful error handling
- ‚úÖ –ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

---

## üéâ **–ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï**

**‚úÖ –ú–ò–°–°–ò–Ø –í–´–ü–û–õ–ù–ï–ù–ê –ù–ê –í–°–ï 101%!**

–í—Å–µ 3 –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Ä–µ—à–µ–Ω—ã:
1. ‚úÖ –ö–Ω–æ–ø–∫–∞ "–°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞–Ω–∏–µ" —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑—É–ø—Ä–µ—á–Ω–æ
2. ‚úÖ –ö–∞–±–∏–Ω–µ—Ç –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Å—Ç–∞–±–∏–ª—å–Ω–æ –±–µ–∑ –æ—à–∏–±–æ–∫  
3. ‚úÖ –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç –∏–¥–µ–∞–ª—å–Ω–æ

**–ë–æ—Ç –≥–æ—Ç–æ–≤ –∫ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–π —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–∏! üöÄ**

*–ü—Ä–æ–±–ª–µ–º –±–æ–ª—å—à–µ –ù–ï–¢. –í—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –ò–î–ï–ê–õ–¨–ù–û.*
